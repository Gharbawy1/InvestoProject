<div class="container mx-auto py-10 px-4 max-w-4xl bg-white">
  <div class="mb-8 text-center animate-fade-in">
    <h1 class="text-2xl font-bold text-gray-900 mb-2">
      Create Business Profile
    </h1>
    <p class="text-sm text-gray-500">
      Complete your business profile to start attracting investors
    </p>
  </div>

  <div class="rounded-lg shadow-sm animate-fade-in">
    <div class="p-6 pt-0">
      <form
        [formGroup]="businessForm"
        (ngSubmit)="onSubmit()"
        class="space-y-6"
      >
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Business Name -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Business Name*</label>
            <input
              formControlName="projectTitle"
              type="text"
              placeholder="Acme Corporation"
              [appAutoFocus]="true"
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
            />
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('projectTitle')?.invalid &&
                  (businessForm.get('projectTitle')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                <div
                  *ngIf="businessForm.get('projectTitle')?.errors?.['required']"
                >
                  * Business name is required
                </div>
                <div
                  *ngIf="businessForm.get('projectTitle')?.errors?.['minlength']"
                >
                  * Minimum 5 characters required (current:
                  {{ businessForm.get("projectTitle")?.value?.length || 0 }})
                </div>
              </div>
            </div>
          </div>

          <!-- Business Tagline -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Tagline*</label>
            <input
              formControlName="subtitle"
              type="text"
              placeholder="Short business summary"
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
            />
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('subtitle')?.invalid &&
                  (businessForm.get('subtitle')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                <div *ngIf="businessForm.get('subtitle')?.errors?.['required']">
                  * Tagline is required
                </div>
                <div
                  *ngIf="businessForm.get('subtitle')?.errors?.['maxlength']"
                >
                  * Maximum 150 characters ({{
                    businessForm.get("subtitle")?.value?.length || 0
                  }}/150)
                </div>
              </div>
            </div>
          </div>

          <!-- Business Location -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Location*</label>
            <input
              formControlName="projectLocation"
              type="text"
              placeholder="City, Governorate"
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
            />
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('projectLocation')?.invalid &&
                  (businessForm.get('projectLocation')?.touched ||
                    formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                * Business location is required
              </div>
            </div>
          </div>

          <!-- Funding Goal -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Funding Goal (LE)*</label>
            <input
              formControlName="fundingGoal"
              type="number"
              placeholder="50000"
              min="100"
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
            />
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('fundingGoal')?.invalid &&
                  (businessForm.get('fundingGoal')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                <div
                  *ngIf="businessForm.get('fundingGoal')?.errors?.['required']"
                >
                  * Funding goal is required
                </div>
                <div *ngIf="businessForm.get('fundingGoal')?.errors?.['min']">
                  * Minimum 10000 LE required
                </div>
              </div>
            </div>
          </div>

          <!-- Category -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Category*</label>
            <div *ngIf="isLoadingCategories" class="text-gray-500 text-sm mb-1">
              Loading categoriesâ€¦
            </div>
            <div *ngIf="errorMessage" class="text-red-500 text-sm mb-1">
              {{ errorMessage }}
            </div>
            <select
              formControlName="categoryId"
              title="Select a category"
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
            >
              <option value="" disabled selected>Select category</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('categoryId')?.invalid &&
                  (businessForm.get('categoryId')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                * Category is required
              </div>
            </div>
          </div>
        </div>

        <!-- Business Image -->
        <div class="flex flex-col gap-0.5 form-group">
          <label class="text-sm font-medium">Business Image*</label>
          <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center transition-colors hover:border-gray-400"
          >
            <input
              type="file"
              accept="image/*"
              (change)="onImageSelected($event)"
              hidden
              #businessImageInput
              hidden
              required
            />
            <button
              type="button"
              class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 text-sm font-medium transition-colors"
              (click)="businessImageInput.click()"
            >
              Upload Business image
            </button>
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('projectImage')?.invalid &&
                  (businessForm.get('projectImage')?.touched || formSubmitted)
                "
                class="text-red-500 text-sm mt-1"
              >
                * Please upload a business image
              </div>
            </div>
            <p class="text-sm text-gray-500 mt-2" *ngIf="!businessImageFile">
              Recommended size: 1200x800px (JPEG or PNG)
            </p>
            <div class="text-sm text-green-600 mt-2" *ngIf="businessImageFile">
              {{ businessImageFile.name }} uploaded
            </div>
          </div>
        </div>

        <!-- Business Details -->
        <div class="space-y-6">
          <!-- funding terms -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Funding Terms*</label>
            <textarea
              formControlName="fundingExchange"
              type="text"
              placeholder="Describe funding terms (e.g., '15% Equity')"
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale min-h-[120px]"
            ></textarea>
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('fundingExchange')?.invalid &&
                  (businessForm.get('fundingExchange')?.touched ||
                    formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                * Funding terms description is required
              </div>
            </div>
          </div>

          <!-- Business Vision -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Business Vision*</label>
            <textarea
              formControlName="projectVision"
              placeholder="Describe your long-term business vision..."
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale min-h-[120px]"
            ></textarea>
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('projectVision')?.invalid &&
                  (businessForm.get('projectVision')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                <div
                  *ngIf="businessForm.get('projectVision')?.errors?.['required']"
                >
                  * Vision statement is required
                </div>
                <div
                  *ngIf="businessForm.get('projectVision')?.errors?.['minlength']"
                >
                  * Minimum 100 characters (current: {{ visionLength || 0 }})
                </div>
              </div>
            </div>
          </div>

          <!-- Business Story -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Business Story*</label>
            <textarea
              formControlName="projectStory"
              placeholder="Share your business story and journey..."
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale min-h-[120px]"
            ></textarea>
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('projectStory')?.invalid &&
                  (businessForm.get('projectStory')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                <div
                  *ngIf="businessForm.get('projectStory')?.errors?.['required']"
                >
                  * Business story is required
                </div>
                <div
                  *ngIf="businessForm.get('projectStory')?.errors?.['minlength']"
                >
                  * Minimum 200 characters (current: {{ storyLength || 0 }})
                </div>
              </div>
            </div>
          </div>

          <!-- Current Status -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Current Status*</label>
            <textarea
              formControlName="currentVision"
              placeholder="Describe the current status of your business..."
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale min-h-[120px]"
            ></textarea>
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('currentVision')?.invalid &&
                  (businessForm.get('currentVision')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                * Current status is required
              </div>
            </div>
          </div>

          <!-- Business Goals -->
          <div class="flex flex-col gap-0.5 form-group">
            <label class="text-sm font-medium">Business Goals*</label>
            <textarea
              formControlName="goals"
              placeholder="Outline your business goals..."
              class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale min-h-[120px]"
            ></textarea>
            <div class="min-h-[20px]">
              <div
                *ngIf="
                  businessForm.get('goals')?.invalid &&
                  (businessForm.get('goals')?.touched || formSubmitted)
                "
                class="animate-slide-in error-message text-red-500 text-sm"
                aria-live="polite"
              >
                * Business goals are required
              </div>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <!--<button 
          type="submit" 
          [disabled]="isLoading || businessForm.invalid || !businessImageFile" 
          class="w-full text-sm font-medium py-2.5 rounded-md transition flex items-center justify-center cursor-pointer transition-button button-hover"
          [ngClass]="{
            'bg-gray-900 text-white hover:bg-gray-800 active:bg-gray-700': !isLoading && !businessForm.invalid,
            'bg-gray-300 text-gray-500 cursor-not-allowed': isLoading || businessForm.invalid || !businessImageFile
          }">-->
        <!-- for test -->
        <button
          type="submit"
          [disabled]="isLoading || businessForm.invalid"
          class="w-full text-sm font-medium py-2.5 rounded-md transition flex items-center justify-center cursor-pointer transition-button button-hover"
          [ngClass]="{
            'bg-gray-900 text-white hover:bg-gray-800 active:bg-gray-700':
              !isLoading && !businessForm.invalid,
            'bg-gray-300 text-gray-500 cursor-not-allowed':
              isLoading || businessForm.invalid
          }"
        >
          <span *ngIf="!isLoading">Publish Business Profile</span>
          <span *ngIf="isLoading" class="flex items-center">
            <svg
              class="animate-spin h-4 w-4 mr-2"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="12" cy="12" r="10" stroke-width="4"></circle>
              <path d="M4 12a8 8 0 0 1 16 0" stroke-linecap="round"></path>
            </svg>
            Submitting...
          </span>
        </button>
      </form>
    </div>
  </div>
</div>
