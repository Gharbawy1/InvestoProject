<div class="p-6 space-y-8 animate-fade-in">
  <h2 class="text-2xl font-bold text-gray-900 text-center form-container">Personal Info.</h2>
  <!-- Personal Information Form -->
  <form [formGroup]="personalInfoForm" (ngSubmit)="onSubmit()" class="space-y-3 animate-stagger">    
    <!-- Name Row -->
    <div class="grid grid-cols-2 gap-4">
      <!-- First Name -->
      <div class="flex flex-col gap-0.5 form-group">
        <label for="firstName" class="text-sm font-medium">First Name</label>
        <input
          id="firstName"
          [appAutoFocus]="true"
          formControlName="firstName"
          placeholder="Your first name"
          class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
        />
        <div class="min-h-[20px]">
          <p *ngIf="personalInfoForm.get('firstName')?.errors?.['required'] && (personalInfoForm.get('firstName')?.touched || formSubmitted)"
            class="text-red-500 text-sm animate-slide-in animate-slide-in error-message" aria-live="polite">
            * First name is required
          </p>
          <p *ngIf="personalInfoForm.get('firstName')?.errors?.['minlength']"
            class="text-red-500 text-sm animate-slide-in animate-slide-in error-message" aria-live="polite">
            * Minimum 2 characters required
          </p>
          <p *ngIf="personalInfoForm.get('firstName')?.errors?.['pattern']"
            class="text-red-500 text-sm animate-slide-in animate-slide-in error-message" aria-live="polite">
            * Only letters and spaces allowed
          </p>
        </div>
      </div>

      <!-- Last Name -->
      <div class="flex flex-col gap-0.5 form-group">
        <label for="lastName" class="text-sm font-medium">Last Name</label>
        <input
          id="lastName"
          formControlName="lastName"
          placeholder="Your last name"
          class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
        />
        <div class="min-h-[20px]">
          <p *ngIf="personalInfoForm.get('lastName')?.errors?.['required'] && (personalInfoForm.get('lastName')?.touched || formSubmitted)"
            class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
            * Last name is required
          </p>
          <p *ngIf="personalInfoForm.get('lastName')?.errors?.['minlength']"
            class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
            * Minimum 2 characters required
          </p>
          <p *ngIf="personalInfoForm.get('lastName')?.errors?.['pattern']"
            class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
            * Only letters and spaces allowed
          </p>
        </div>
      </div>
    </div>

    <!-- Birth Date -->
    <div class="flex flex-col gap-0.5">
      <label class="text-sm font-medium">Date of Birth</label>
      <div class="grid grid-cols-3 gap-4">
        <!-- Day -->
        <div class="flex flex-col gap-0.5 form-group">
          <select 
            title="Select your birth day"
            formControlName="birthDay"
            class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-900 focus:ring-gray-900 cursor-pointer transition-select select-hover"
          >
            <option value="" disabled selected>Day</option>
            <option *ngFor="let day of days" [value]="day">{{ day }}</option>
          </select>
          <div class="min-h-[20px]">
            <p *ngIf="personalInfoForm.get('birthDay')?.errors?.['required'] && formSubmitted"
              class="text-red-500 text-sm animate-slide-in error-message">
              * Day is required
            </p>
          </div>
        </div>

        <!-- Month -->
        <div class="flex flex-col gap-0.5 form-group">
          <select 
            title="Select your birth month"
            formControlName="birthMonth"
            class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-900 focus:ring-gray-900 cursor-pointer transition-select select-hover"
          >
            <option value="" disabled selected>Month</option>
            <option *ngFor="let month of months" [value]="month.value">{{ month.name }}</option>
          </select>
          <div class="min-h-[20px]">
            <p *ngIf="personalInfoForm.get('birthMonth')?.errors?.['required'] && formSubmitted"
              class="text-red-500 text-sm animate-slide-in error-message">
              * Month is required
            </p>
          </div>
        </div>

        <!-- Year -->
        <div class="flex flex-col gap-0.5 form-group">
          <select
            title="Select your birth year" 
            formControlName="birthYear"
            class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-900 focus:ring-gray-900 cursor-pointer transition-select select-hover"
          >
            <option value="" disabled selected>Year</option>
            <option *ngFor="let year of years" [value]="year">{{ year }}</option>
          </select>
          <div class="min-h-[20px]">
            <p *ngIf="personalInfoForm.get('birthYear')?.errors?.['required'] && formSubmitted"
              class="text-red-500 text-sm animate-slide-in error-message">
              * Year is required
            </p>
          </div>
        </div>
      </div>
      <p *ngIf="personalInfoForm.errors?.['invalidDate'] && formSubmitted" 
        class="text-red-500 text-sm animate-slide-in error-message">
        * Please select a valid date
      </p>
    </div>

    <!-- Phone Number -->
    <div class="flex flex-col gap-0.5 form-group">
      <label for="phone" class="text-sm font-medium">Phone Number</label>
      <input
        id="phone"
        formControlName="phone"
        placeholder="+1234567890"
        class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm placeholder-gray-400 focus:border-gray-900 focus:ring-gray-900 transition-input input-scale"
      />
      <div class="min-h-[20px]">
        <p *ngIf="personalInfoForm.get('phone')?.errors?.['required'] && (personalInfoForm.get('phone')?.touched || formSubmitted)"
          class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
          * Phone number is required
        </p>
        <p *ngIf="personalInfoForm.get('phone')?.errors?.['pattern'] && (personalInfoForm.get('phone')?.touched || formSubmitted)"
          class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
          * Please enter a valid international number
        </p>
      </div>
    </div>

    <!-- Country -->
    <div class="flex flex-col gap-1 form-group">
      <label for="country" class="text-sm font-medium text-gray-700">Country</label>
      <select
        title="Select your country"
        formControlName="country"
        class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-900 focus:ring-gray-900 cursor-pointer transition-select select-hover"
        [disabled]="loadingCountries"
      >
        <option value="" disabled selected class="text-gray-400">Select your country</option>
        <option *ngFor="let country of countries" [value]="country.name">
          {{ country.name }} ({{ country.code }})
        </option>
        <option *ngIf="loadingCountries" class="text-gray-400" disabled>
          Loading countries...
        </option>
      </select>
      <div class="min-h-[20px]">
        <p *ngIf="personalInfoForm.get('country')?.errors?.['required'] && (personalInfoForm.get('country')?.touched || formSubmitted)"
          class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
          * Please select your country
        </p>
      </div>
    </div>

    <!-- State/City Row -->
    <div class="grid grid-cols-2 gap-4">
      <!-- State -->
      <div class="flex flex-col gap-1 form-group">
        <label for="state" class="text-sm font-medium text-gray-700">State/Province</label>
        <select
          title="Select your state"
          formControlName="state"
          class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-900 focus:ring-gray-900 cursor-pointer transition-select select-hover"
          [disabled]="!states.length || loadingStates"
        >
          <option value="" disabled selected class="text-gray-400">Select your state</option>
          <option *ngFor="let state of states" [value]="state.name" class="text-gray-400">
            {{ state.name }}
          </option>        
          <option *ngIf="loadingStates" class="text-gray-400" disabled>
            Loading states...
          </option>
        </select>
        <div class="min-h-[20px]">
          <p *ngIf="personalInfoForm.get('state')?.errors?.['required'] && (personalInfoForm.get('state')?.touched || formSubmitted)"
            class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
            * Please select your state
          </p>
        </div>
      </div>

      <!-- City -->
      <div class="flex flex-col gap-1 form-group">
        <label for="city" class="text-sm font-medium text-gray-700">City</label>
        <select
          title="Select your city"
          formControlName="city"
          class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-900 focus:ring-gray-900 cursor-pointer transition-select select-hover"
          [disabled]="!cities.length || loadingCities"
        >
          <option value="" disabled selected class="text-gray-400">Select your city</option>
          <option *ngFor="let city of cities" [value]="city.name" class="text-gray-400">
            {{ city.name }}
          </option>
          <option *ngIf="loadingCities" class="text-gray-400" disabled>
            Loading cities...
          </option>
        </select>
        <div class="min-h-[20px]">
          <p *ngIf="personalInfoForm.get('city')?.errors?.['required'] && (personalInfoForm.get('city')?.touched || formSubmitted)"
            class="text-red-500 text-sm animate-slide-in error-message" aria-live="polite">
            * Please select your city
          </p>
        </div>
      </div>
    </div>

    <!-- Continue Button -->
    <button 
      type="submit" 
      [disabled]="isLoading || personalInfoForm.invalid" 
      class="w-full text-sm font-medium py-2 mb-2 rounded-md transition flex items-center justify-center cursor-pointer transition-button button-hover"
      [ngClass]="{
        'bg-gray-900 text-white hover:bg-gray-800 active:bg-gray-700': !isLoading && personalInfoForm.valid,
        'bg-gray-300 text-gray-500 cursor-not-allowed': isLoading || personalInfoForm.invalid
      }">
      <span *ngIf="!isLoading">Continue</span>
      <span *ngIf="isLoading" class="flex items-center">
        <svg class="animate-spin h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke-width="4"></circle>
          <path d="M4 12a8 8 0 0 1 16 0" stroke-linecap="round"></path>
        </svg>
        Loading...
      </span>
    </button>
  </form>
</div>